%!TEX TS-program = xelatex
%!TEX encoding = UTF-8 Unicode

% Author: Romain "Artefact2" Dal Maso <artefact2@gmail.com>
% 
% This program is free software. It comes without any warranty, to the
% extent permitted by applicable law. You can redistribute it and/or
% modify it under the terms of the Do What The Fuck You Want To Public
% License, Version 2, as published by Sam Hocevar. See
% http://sam.zoy.org/wtfpl/COPYING for more details.

\newcommand*{\phSBPrevdesclabel}{}
\newcommand*{\phSBPrevsubsecstyle}{}
\newcommand*{\phSBPrevsubsubsecstyle}{}
\newcommand*{\phSBPrevparastyle}{}

\newlength{\phSBPrevparaskip}
\newlength{\phSBPrevsubsubsecskip}

\newcommand*{\phSBType}[1]{\textit{#1}}
\newcommand*{\phSBSep}{%
  \leavevmode\\*%
  \noindent\includegraphics[height=5pt,width=\columnwidth]{assets/stat-block-separator}\\*%
  \noindent%
}
\newcommand*{\phModifier}[1]{\FPeval{\result}{round((2*trunc(#1/2,0)-10)/2,0)}\ifnum\result>-1 +\result\else\result\fi}
\newcommand*{\phSBAttributes}[6]{%
  {\color{chapter}%
  \begin{tabularx}{\columnwidth}{@{}*{6}{>{\centering\arraybackslash}X@{}}}
    \textbf{STR} & \textbf{DEX} & \textbf{CON} & \textbf{INT} & \textbf{WIS} & \textbf{CHA} \\
    #1 (\phModifier{#1}) & #2 (\phModifier{#2}) & #3 (\phModifier{#3}) & #4 (\phModifier{#4}) & #5 (\phModifier{#5}) & #6 (\phModifier{#6})
  \end{tabularx}}%
}
\newcommand*{\phSBsubsec}[1]{\color{chapter}\Huge\mreaves#1\vspace*{-7pt}}
\newcommand*{\phSBsubsubsec}[1]{\color{chapter}\LARGE\scaly\scshape\noindent\begin{minipage}{\columnwidth}#1\vspace*{1pt}\rule[\baselineskip]{\columnwidth}{1pt}\end{minipage}\vspace*{-\baselineskip}\vspace*{3pt}}

\NewEnviron{phStatBlockDescription}{%
  \renewcommand*{\phSBPrevdesclabel}{\descriptionlabel}%
  \renewcommand*{\descriptionlabel}{\color{chapter}\hspace\labelsep\scaly\bfseries}%
  \begin{description}\tightlist\setlength{\labelsep}{3pt}\color{chapter}%
    \vspace*{-\topsep}\BODY\vspace*{-\topsep}%
  \end{description}%
  \renewcommand*{\descriptionlabel}{\phSBPrevdesclabel}%
}

\NewEnviron{phStatBlock}{%
  \renewcommand*{\phSBPrevparastyle}{\paraheadstyle}%
  \renewcommand*{\phSBPrevsubsecstyle}{\subsecheadstyle}%
  \renewcommand*{\phSBPrevsubsubsecstyle}{\subsubsecheadstyle}%
  \setparaheadstyle{\scaly\small\bfseries}%
  \setsubsecheadstyle{\phSBsubsec}%
  \setsubsubsecheadstyle{\phSBsubsubsec}%
  \setlength{\phSBPrevparaskip}{\beforeparaskip}%
  \setlength{\phSBPrevsubsubsecskip}{\beforesubsubsecskip}%
  \setbeforeparaskip{.5em}%
  \setbeforesubsubsecskip{.5em}%
  \medbreak{\scaly\small\BODY}\medbreak%
  \setparaheadstyle{\phSBPrevparastyle}%
  \setsubsecheadstyle{\phSBPrevsubsecstyle}%
  \setsubsubsecheadstyle{\phSBPrevsubsubsecstyle}%
  \setbeforeparaskip{\phSBPrevparaskip}%
  \setbeforesubsubsecskip{\phSBPrevsubsubsecskip}%
}
