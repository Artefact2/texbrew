%!TEX TS-program = xelatex
%!TEX encoding = UTF-8 Unicode

% Author: Romain "Artefact2" Dal Maso <artefact2@gmail.com>
% 
% This program is free software. It comes without any warranty, to the
% extent permitted by applicable law. You can redistribute it and/or
% modify it under the terms of the Do What The Fuck You Want To Public
% License, Version 2, as published by Sam Hocevar. See
% http://sam.zoy.org/wtfpl/COPYING for more details.

\pageaiv
\setulmarginsandblock{15mm}{20mm}{1}
\setlrmarginsandblock{20mm}{16mm}{1}
\setcolsepandrule{8mm}{0mm}
\setheadfoot{12mm}{12mm}
\setheaderspaces{*}{0mm}{*}
\settypeoutlayoutunit{mm}
\checkandfixthelayout

\setlength{\multicolsep}{0pt} % XXX may have bad side effects?
\frenchspacing
\raggedright % Messes up the indent.
\setlength{\parindent}{1em}

% XXX why is this breaking \twocolumn (will reset to one after a part) ?
\AddEverypageHook{\begin{textblock*}{\paperwidth}(0pt,0pt)%
    \includegraphics[width=\paperwidth,height=\paperheight]{assets/background}%
\end{textblock*}\twocolumn}

\makepagestyle{hbRegular}
\aliaspagestyle{chapter}{hbRegular}
\aliaspagestyle{part}{hbRegular}

\makeoddfoot{hbRegular}{%
  \begin{minipage}{0pt}%
    \hspace*{-20mm}\includegraphics[draft=false,width=\paperwidth]{assets/footer}%
  \end{minipage}%
}{}{
  \color{footer}\mreaves \rightmark \hspace{3mm}\vspace{-1mm} \\
  \Large\raisebox{2mm}{\begin{minipage}{2cm}\centering\thepage\end{minipage}}\hspace{-20mm}
}
\makeevenfoot{hbRegular}{
  \color{footer}\mreaves \hspace{3mm}\vspace{-1mm} \leftmark \\
  \Large\hspace{-20mm}\raisebox{2mm}{\begin{minipage}{2cm}\centering\thepage\end{minipage}}
}{}{%
  \begin{minipage}{0pt}%
    \hspace*{-\paperwidth}\hspace*{20mm}\hspace*{-1pt}%
    \reflectbox{\includegraphics[draft=false,width=\paperwidth]{assets/footer}}%
  \end{minipage}%
}

\makepsmarks{hbRegular}{
\renewcommand*{\partmark}[1]{\markboth{part \thepart\space\rule{1pt}{.4\baselineskip}\space\MakeLowercase{##1}}{part \thepart\space\rule{1pt}{.4\baselineskip}\space\MakeLowercase{##1}}}
\renewcommand*{\chaptermark}[1]{\partmark{##1}}
\renewcommand*{\sectionmark}[1]{}
}

\pagestyle{hbRegular}
